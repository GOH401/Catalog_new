{% extends 'base.html' %}
{% load static %}

{% block title %}{{ carpet.name }} ‚Äî –ü–æ–¥—Ä–æ–±–Ω–µ–µ{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/panzoom@9.4.0/dist/panzoom.min.js"></script>

<style>
  /* –û–±—â–∏–µ hover-—ç—Ñ—Ñ–µ–∫—Ç—ã */
  .btn-hover {
    transition: background .2s ease, color .2s ease, transform .15s ease;
  }
  .btn-hover:hover {
    transform: translateY(-2px);
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Ö–æ–∂–∏—Ö –∫–æ–≤—Ä–æ–≤ */
  .card-hover {
    transition: box-shadow .2s ease, transform .2s ease;
  }
  .card-hover:hover {
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    transform: translateY(-4px) scale(1.02);
  }

  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å aspect-ratio */
  .img-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 125%; /* 4:5 */
    overflow: hidden;
    border-radius: .75rem;
    background: #000;
  }
  .img-wrapper img {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: contain;
    cursor: grab;
    transition: transform .2s ease;
  }
  .img-wrapper img:hover {
    transform: scale(1.01);
  }
</style>

<div class="container-fluid px-3 py-3">

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <a href="{% url 'collection_cards' %}" class="btn btn-outline-primary btn-lg btn-hover">‚Üê –í –∫–∞—Ç–∞–ª–æ–≥</a>
    <a href="{% url 'collection_detail' carpet.collection.id %}" class="btn btn-outline-secondary btn-lg btn-hover">
      ‚Üê –í –∫–æ–ª–ª–µ–∫—Ü–∏—é ¬´{{ carpet.collection.name }}¬ª
    </a>
  </div>

  <div class="row gx-3 gy-4">
    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
    <div class="col-12 col-md-6">
      <div class="img-wrapper shadow-sm">
        {% if carpet.image %}
          <img src="{{ carpet.image }}" alt="{{ carpet.name }}" id="zoom-img">
        {% else %}
          <div class="d-flex h-100 w-100 align-items-center justify-content-center text-white">
            –ù–µ—Ç —Ñ–æ—Ç–æ
          </div>
        {% endif %}
      </div>
      <div class="mt-2 text-center text-muted small">–ö–æ–ª—ë—Å–∏–∫–æ ‚Äî –∑—É–º, —Ç—è–Ω—É—Ç—å ‚Äî –ø–∞–Ω–æ—Ä–∞–º–∞</div>
      <div class="text-center mt-2">
        <button id="reset-zoom-btn" class="btn btn-outline-secondary btn-sm btn-hover">–°–±—Ä–æ—Å–∏—Ç—å –∑—É–º</button>
      </div>
    </div>

    <!-- –ò–Ω—Ñ–æ -->
    <div class="col-12 col-md-6">
      <h2 class="fs-2 fw-bold mb-3">{{ carpet.name }}</h2>

      <div class="d-flex flex-wrap gap-2 mb-3">
        {% if prev_id %}
          <a href="{% url 'carpet_detail' prev_id %}" class="btn btn-outline-dark btn-lg btn-hover">‚Üê</a>
        {% endif %}
        {% if next_id %}
          <a href="{% url 'carpet_detail' next_id %}" class="btn btn-outline-dark btn-lg btn-hover">‚Üí</a>
        {% endif %}
      </div>

      <div class="d-flex flex-wrap gap-2 mb-3">
        <span class="badge bg-info text-dark fs-6">–ö–æ–ª–ª–µ–∫—Ü–∏—è: {{ carpet.collection.name }}</span>
        {% if carpet.style %}
          <span class="badge bg-secondary fs-6">–°—Ç–∏–ª—å: {{ carpet.get_style_display }}</span>
        {% endif %}
      </div>

      <ul class="list-group list-group-flush mb-4 fs-5">
        <li class="list-group-item"><strong>–ö–æ–¥:</strong> {{ carpet.code }}</li>
        <li class="list-group-item"><strong>–¶–≤–µ—Ç:</strong> {{ carpet.color }}</li>
        {% if carpet.main_colors %}
          <li class="list-group-item">
            <strong>–û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞:</strong>
            {% for color in carpet.main_colors %}
              <span class="d-inline-block rounded-circle border me-1"
                    style="width: 24px; height: 24px; background: {{ color }};"></span>
            {% endfor %}
          </li>
        {% endif %}
      </ul>

      <h5 class="fs-4 mb-3">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h5>
      <dl class="row fs-5 mb-4">
        {% if carpet.loom_width %}
          <dt class="col-4">–®–∏—Ä–∏–Ω–∞ —Å—Ç–∞–Ω–∫–∞</dt><dd class="col-8">{{ carpet.loom_width }}</dd>
        {% endif %}
        {% if carpet.quality %}
          <dt class="col-4">–ö–∞—á–µ—Å—Ç–≤–æ</dt><dd class="col-8">{{ carpet.quality }}</dd>
        {% endif %}
        {% if carpet.pile_height %}
          <dt class="col-4">–í—ã—Å–æ—Ç–∞ –≤–æ—Ä—Å–∞</dt><dd class="col-8">{{ carpet.pile_height }}</dd>
        {% endif %}
        {% if carpet.thread_percent_left or carpet.thread_material_left or carpet.thread_percent_right or carpet.thread_note %}
          <dt class="col-4">–°–æ—Å—Ç–∞–≤</dt>
          <dd class="col-8">
            {{ carpet.thread_percent_left }} {{ carpet.thread_material_left }}
            {% if carpet.thread_percent_right %}+ {{ carpet.thread_percent_right }}{% endif %}
            {{ carpet.thread_note }}
          </dd>
        {% endif %}
      </dl>

      {% if user.is_authenticated %}
        <div class="d-flex gap-3 flex-wrap">
          <a href="{% url 'carpet_update' carpet.pk %}" class="btn btn-primary btn-lg flex-fill btn-hover">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <a href="{% url 'carpet_delete' carpet.pk %}" class="btn btn-danger btn-lg flex-fill btn-hover">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- –ü–æ—Ö–æ–∂–∏–µ –∫–æ–≤—Ä—ã -->
  {% if similar_carpets %}
    <h3 class="fs-3 fw-bold mt-5 mb-3">–ü–æ—Ö–æ–∂–∏–µ –∫–æ–≤—Ä—ã</h3>
    <div class="row gx-2 gy-3">
      {% for c in similar_carpets %}
        <div class="col-6 col-sm-4 col-md-3 col-lg-2">
          <a href="{% url 'carpet_detail' c.pk %}" class="text-decoration-none text-dark">
            <div class="card card-hover h-100 shadow-sm">
              {% if c.image %}
                <img src="{{ c.image }}" alt="{{ c.name }}"
                     class="card-img-top object-fit-cover"
                     style="aspect-ratio:1;">
              {% else %}
                <div class="d-flex align-items-center justify-content-center bg-light"
                     style="aspect-ratio:1;">
                  <span class="text-muted">–ù–µ—Ç —Ñ–æ—Ç–æ</span>
                </div>
              {% endif %}
              <div class="card-body p-2 text-center fs-6">
                <div class="fw-semibold">{{ c.name }}</div>
                <div class="text-muted small">–ö–æ–¥: {{ c.code }}</div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const img = document.getElementById('zoom-img');
  if (!img) return;
  panzoom(img, { maxZoom:8, minZoom:1, bounds:true, boundsPadding:0.2 });
});
</script>
{% endblock %}
